<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>MySQL与HikariCP | 搬砖手账</title><link rel=icon type=image/x-icon><link rel=stylesheet href=//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css><link rel=stylesheet href=//cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.2/build/styles/rainbow.min.css><link rel=stylesheet href="/static/style.min.css?v=822c8e" integrity media=screen></head><body><header class="lay-header box-header"></header><div class=lay-wrapper><aside class="lay-aside box-aside"><div class=box-shadow-without-top><div class=box-logo><a href=https://hankliuhuan.com/>搬砖手账</a><p>沉心营浮世，热血饮凉冰</p><div class=box-menu-toggle id=id-menu-toggle><button>
<span></span><span></span><span></span></button></div></div><nav class="box-nav bg-white box-nav-min-hiden" id=id-menu><div><a href=/><i class="fa fa-fw fa-home fa-home"></i>Home</a></div><div><a href=/about><i class="fa fa-fw fa-home fa-user-md"></i>About</a></div><div class=box-nav-active><a href=/posts><i class="fa fa-fw fa-home fa-archive"></i>Archives</a></div><div><a href=/tags><i class="fa fa-fw fa-home fa-tag"></i>Tags</a></div></nav></div><div class="box-ref box-shadow bg-white" id=id-fix><div class=box-toc><nav id=TableOfContents><ul><li><a href=#综述>综述</a></li><li><a href=#连接池连接数量与超时时间>连接池连接数量与超时时间</a></li></ul></nav></div><div class=box-backtop id=id-backtop><i class="fa fa-arrow-up"></i><span></span></div></div></aside><main class="lay-main box-main"><div class="box-main-min bg-white box-main-padding box-shadow-without-top box-post"><article><div class=box-post-title>MySQL与HikariCP</div><div class=box-post-meta><i class="fa fa-fw fa-calendar-check-o"></i>2019/02/18
<span>|</span>
<i class="fa fa-fw fa-keyboard-o"></i>1091
<span>|</span>
<i class="fa fa-fw fa-tags"></i>mysql, hikaricp</div><div class=typ-article><h2 id=综述>综述</h2><p>作为开发后端的Java程序员，除了语言本身，中间件的使用也是衡量水平的标准之一。特别是以MySQL为代表的数据库，优秀的开发者可以根据不同的需求，调整不同的方案，扬长避短，用出更好的效果。反之，如果只用默认配置，或者没有经过论证就胡乱使用配置，和容易造成性能瓶颈。</p><p>程序员使用MySQL，基础的有两点，一个是客户端参数配置，另外一个sql语句。本系列着重探究HikariCP作为客户端时的参数配置。</p><h2 id=连接池连接数量与超时时间>连接池连接数量与超时时间</h2><p>数据库连接池存在的目的，就是为了避免频繁创建与销毁与数据库服务的网络会话连接。其核心解决的问题是需要如何维护按需增减的连接数。</p><p>Java连接池的解决逻辑一般是：</p><ol><li><p>系统初始化时，首先访问数据库，如果在initializationFailTimeout时间内还没能成功访问，则抛出无法初始化的异常，系统初始化失败。如果可以访问到数据库，则创建minimumIdle个数据库会话连接。</p></li><li><p>系统处理用户的访问请求逐步增多。服务需要访问数据库时，则向连接池申请一个空闲连接。如果这个时候有空闲连接，则分配一个空闲连接。如果这个时候没有空闲连接，则会再创建一个。用户访问导致不断创建连接数数量达到maximumPoolSize数量。后面再进来的请求会被阻塞住以等待其他请求释放连接，如果等待时间超过connectionTimeout时返回异常。</p></li><li><p>系统处理用户的访问请求逐步减少。创建的连接数大于minimumIdle数量，但是有空闲连接。则这些连接的空闲时间大于idleTimeout时，会被连接池释放掉。最终使得连接数等于minimumIdle。访问量进一步减少，连接数等于minimumIdle，但是还是有空闲连接。空闲连接时间超过maxLifetime时，连接池会刷新该连接，保证不被MySQL主动断掉，同时重置空闲时间。</p></li></ol><table><thead><tr><th align=left>HikariCP配置项</th><th align=left>单位</th><th align=left>默认值</th><th align=left>说明</th></tr></thead><tbody><tr><td align=left>minimumIdle</td><td align=left>个</td><td align=left>与maximumPoolSize相同</td><td align=left>连接池与数据库保持连接数量的最小值,官方建议不要设置此值而保持默认</td></tr><tr><td align=left>maximumPoolSize</td><td align=left>个</td><td align=left>10</td><td align=left>连接池中允许的最大连接数。推荐的公式：((core_count * 2) + effective_spindle_count)</td></tr><tr><td align=left>idleTimeout</td><td align=left>毫秒</td><td align=left>600000（10分钟）</td><td align=left>空闲时间超过多久后，该连接被释放掉</td></tr><tr><td align=left>maxLifetime</td><td align=left>毫秒</td><td align=left>1800000（30分钟）</td><td align=left>空闲时间超过多久后，该连接被刷新。一定要小于MySQL服务器的wait-timeout值。繁忙的系统该值不要设置过大</td></tr><tr><td align=left>connectionTimeout</td><td align=left>毫秒</td><td align=left>30000 (30分钟)</td><td align=left>向连接池申请连接时等待的最长时间</td></tr><tr><td align=left>validationTimeout</td><td align=left>毫秒</td><td align=left>5000</td><td align=left>验证连接是否有效时的超时时间</td></tr><tr><td align=left>initializationFailTimeout</td><td align=left>毫秒</td><td align=left>1</td><td align=left>在超时期间内无法初始化成功连接池，则抛出异常。如果设置为0，会尝试重连，重连失败则抛异常终止连接池，小于0表示不重连，默认值1</td></tr></tbody></table></div></article><div class=box-license>本文档创作遵循
<a target=_blank href=https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh>「署名-非商业性使用-禁止演绎 4.0 国际版 (CC BY-NC-ND 4.0)」</a></div><div class=box-article-nav><a href=/posts/hashids/><i class="fa fa-chevron-left"></i><span>hashids-内外标识符转换方案</span></a>
<a href=/posts/email-anti-counterfeiting/><span>邮件防伪造</span><i class="fa fa-chevron-right"></i></a></div></div></main></div><footer class="lay-footer box-footer"><span>Copyright
&nbsp;&copy;
&nbsp;2019-2020
&nbsp;<a href=https://hankliuhuan.com/>写代码的招财猫</a>,
&nbsp;All Rights Reserved.</span></footer><script src=//cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.2/build/highlight.min.js></script><script>hljs.initHighlightingOnLoad();</script><script type=text/javascript src="/static/script.min.js?v=e95e58" integrity></script></body></html>